<div class="helper-send-container step-{{ctrl.step}}" ng-class="{true:'show',false:'hide'}[!!ctrl.show]">
    <h1 class="head">
        <button ng-click="ctrl.show = false" class="pull-right close h-btn h-btn-link">×</button>
        群发信息
    </h1>

    <div class="body">
        <ul class="steps">
            <li class="item current" ng-class="{current:ctrl.step === 1, done:ctrl.step > 1}">
                <span>输入内容</span>
            </li>
            <li class="item" ng-class="{current:ctrl.step === 2, done:ctrl.step > 2}">
                <span>选择联系人</span>
            </li>
            <li class="item" ng-class="{current:ctrl.step === 3, done:ctrl.step > 3}">
                <span>确认发送</span>
            </li>
        </ul>

        <!-- steps -->
        <ul class="h-scene scene{{ctrl.step}}">
            <!-- step1 -->
            <li>
                <div ng-style="{'margin-top': ctrl.isWxFaceShowed && '165px'}" class="editor-container">
                    <!-- render from JS -->
                </div>

                <div class="footer text-right">
                    <button ng-click="ctrl.toNext(2);" class="h-btn">下一步</button>
                </div>
            </li>

            <!-- step2 -->
            <li>
                <div class="content">
                    <!-- 待选 -->
                    <div class="transfer">
                        <button ng-click="ctrl.dynamicGroups.save()"
                                ng-class="{active:ctrl.contactTab === 3}"
                                class="btn-auto-groups h-btn h-btn-xs pull-right">⭐️ 动态分组
                        </button>
                        <ul class="nav nav-underline">
                            <li ng-class="{active:ctrl.contactTab === 1}">
                                <a ng-click="ctrl.changeContactTab(1)" href="javascript:">联系人</a>
                            </li>
                            <li ng-class="{active:ctrl.contactTab === 2}">
                                <a ng-click="ctrl.changeContactTab(2)" href="javascript:">讨论组</a>
                            </li>
                            <li ng-class="{active:ctrl.contactTab === 3}">
                                <a ng-click="ctrl.changeContactTab(3)" href="javascript:">我的分组</a>
                            </li>
                        </ul>

                        <div class="h-scene scene{{ctrl.contactTab}}">
                            <!-- 联系人 -->
                            <section>
                                <div class="tool-bar">
                                    <label class="cursor-pointer" ng-click="ctrl.contactsChecker.allCheck()">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[ctrl.contactsChecker.isAllChecked]">
                                        </i>
                                        {{ctrl.airScrollContacts.sourceItems.length}}条
                                    </label>
                                    <input ng-model="ctrl.contactKey"
                                           ng-change="ctrl.filterList(ctrl.contactKey, 'airScrollContacts','contacts')"
                                           type="text" placeholder="输入任意内容搜索">
                                    <i class="addchat_searchicon"></i>
                                </div>


                                <ul class="item contacts">
                                    <li ng-click="ctrl.contactsChecker.check(item,!item._checked)"
                                        ng-repeat="item in ctrl.airScrollContacts.items track by item.UserName">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[!!item._checked]"></i>
                                        <img class="img"
                                             ng-src="{{item.HeadImgUrl}}"
                                             alt="">
                                        <span title="{{item.RemarkName || item.NickName}}"
                                              ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                                    </li>
                                </ul>
                            </section>

                            <!-- 讨论组 -->
                            <section>
                                <div class="tool-bar">
                                    <label class="cursor-pointer" ng-click="ctrl.chatroomsChecker.allCheck()">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[ctrl.chatroomsChecker.isAllChecked]"></i>
                                        {{ctrl.airScrollChatrooms.sourceItems.length}}条
                                    </label>
                                    <input ng-model="ctrl.chatroomsKey"
                                           ng-change="ctrl.filterList(ctrl.chatroomsKey, 'airScrollChatrooms','chatrooms')"
                                           type="text" placeholder="输入任意内容搜索">
                                    <i class="addchat_searchicon"></i>
                                </div>

                                <ul class="item chatrooms">
                                    <li ng-click="ctrl.chatroomsChecker.check(item,!item._checked)"
                                        ng-repeat="item in ctrl.airScrollChatrooms.items track by item.UserName">
                                        <i ng-class="{true:'web_wechat_choose_green', false:'web_wechat_choose_wireframe'}[!!item._checked]"></i>
                                        <img class="img"
                                             ng-src="{{item.HeadImgUrl}}"
                                             alt="">
                                        <span title="{{item.RemarkName || item.NickName}}"
                                              ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                                    </li>
                                </ul>
                            </section>

                            <!-- 分组 -->
                            <section>
                                <ul class="groups item">
                                    <li ng-repeat="(key,value) in ctrl.groups.groups">
                                        <span>
                                            {{key}}
                                            <span style="font-size: 80%"
                                                  class="text-muted">
                                            ({{value.length}}条)
                                            </span>
                                        </span>

                                        <button ng-click="ctrl.selectGroup(key,ctrl.groups.groups[key])"
                                                class="h-btn h-btn-link add">叠加
                                        </button>

                                        <button ng-click="ctrl.selectGroup(key,ctrl.groups.groups[key],true)"
                                                class="h-btn h-btn-link add">替换
                                        </button>

                                        <button ng-click="ctrl.groups.del(key);$event.stopPropagation()"
                                                class="h-btn h-btn-link del">×
                                        </button>

                                        <span class="label label-success">自定</span>
                                    </li>
                                    <li ng-repeat="item in ctrl.dynamicGroups.groups"
                                        ng-if="ctrl.getItemsByRemarkName(item).length !== 0">
                                        <span>
                                             <span ng-bind-html="trustAsHtml(item.showName)"></span>
                                              <span style="font-size: 80%"
                                                    class="text-muted">
                                            ({{ctrl.getItemsByRemarkName(item).length}}条)
                                            </span>
                                        </span>

                                        <button ng-click="ctrl.selectDynamicGroup(item)"
                                                class="h-btn h-btn-link add">叠加
                                        </button>

                                        <button ng-click="ctrl.selectDynamicGroup(item,true)"
                                                class="h-btn h-btn-link add">替换
                                        </button>

                                        <button ng-hide="item.name[0] === '内' ||item.name[0] === '港'"
                                                ng-click="ctrl.dynamicGroups.del(item);$event.stopPropagation()"
                                                class="h-btn h-btn-link del">×
                                        </button>

                                        <span ng-if="item.name[0] === '内' ||item.name[0] === '港'"
                                              class="label label-default stop">内置</span>

                                        <span ng-if="item.name[0] !== '内' && item.name[0] !== '港'"
                                              class="label label-danger">动态</span>
                                    </li>
                                </ul>
                            </section>
                        </div>
                    </div>

                    <!-- 已选 -->
                    <div class="transfer pull-right">
                        <ul class="nav nav-underline checked-list">
                            <li>
                                <button ng-disabled="!(ctrl.contactsChecker.checkedItems.length || ctrl.chatroomsChecker.checkedItems.length)"
                                        ng-click="ctrl.saveGroups()"
                                        class="h-btn h-btn-xs pull-right">保存为分组
                                </button>
                                <a href="javascript:">已选列表</a>
                            </li>
                        </ul>

                        <div class="tool-bar">
                            <label>
                                {{ctrl.chatroomsChecker.checkedItems.length +
                                ctrl.contactsChecker.checkedItems.length}}条
                            </label>
                            <input type="text" ng-model="ctrl.checkedKey" placeholder="输入任意内容搜索">
                            <i class="addchat_searchicon"></i>
                        </div>

                        <ul class="item">
                            <li ng-click="ctrl.chatroomsChecker.check(item,false)"
                                ng-repeat="item in ctrl.chatroomsChecker.checkedItems | filter:ctrl.checkedKey track by item.UserName">
                                <img class="img"
                                     ng-src="{{item.HeadImgUrl}}"
                                     alt="">
                                <span title="{{item.RemarkName || item.NickName}}"
                                      ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                            </li>
                            <li ng-click="ctrl.contactsChecker.check(item,false)"
                                ng-repeat="item in ctrl.contactsChecker.checkedItems | filter:ctrl.checkedKey track by item.UserName">
                                <img class="img"
                                     ng-src="{{item.HeadImgUrl}}"
                                     alt="">
                                <span title="{{item.RemarkName || item.NickName}}"
                                      ng-bind-html="trustAsHtml(item.RemarkName || item.NickName)">
                                        </span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="footer text-right">
                    <button ng-click="ctrl.toNext(1)" class="h-btn h-btn-link">上一步</button>
                    <button ng-disabled="!(ctrl.contactsChecker.checkedItems.length || ctrl.chatroomsChecker.checkedItems.length)"
                            ng-click="ctrl.toNext(3);ctrl.updateMsg()" class="h-btn">下一步
                    </button>
                </div>
            </li>

            <!-- step3 -->
            <li>
                <ul class="step3-container">
                    <li>
                        <label>发送内容:</label>
                        <div ng-bind-html="ctrl.model.msg" class="content">
                        </div>
                    </li>
                    <li>
                        <label>发送条数:</label>
                        <div class="content">
                            {{ctrl.chatroomsChecker.checkedItems.length +
                            ctrl.contactsChecker.checkedItems.length}}条
                        </div>
                    </li>
                    <li>
                        <label>发送间隔:</label>
                        <div class="content">
                            <label>
                                <input type="radio" ng-model="ctrl.sendIntervalType" value="off">
                                无间隔发送
                            </label>
                            <label>
                                <input type="radio" ng-model="ctrl.sendIntervalType" value="on"> 间隔
                                <input ng-model="ctrl.sendInterval"
                                       ng-click="ctrl.sendIntervalType = 'on'"
                                       type="number"> 毫秒
                            </label>
                        </div>
                    </li>
                    <li>
                        <label>预计耗时:</label>
                        <div class="content text-primary">
                            {{ctrl.forecastTime()}}
                        </div>
                    </li>
                </ul>

                <div class="footer text-right">
                    <button ng-click="ctrl.toNext(2)" class="h-btn h-btn-link">上一步</button>
                    <button ng-click="ctrl.toSend()" class="h-btn">确认发送</button>
                </div>
            </li>
        </ul>

    </div>
</div>
<div class="backdrop"></div>

<div class="el-message" ng-class="{'active':ctrl.msgContent}"><img
        src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl9zdWNjZXNzPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IkVsZW1lbnQtZ3VpZGVsaW5lLXYwLjIuNCIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ik1lc3NhZ2UiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC4wMDAwMDAsIC0yMTIuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSLluKblgL7lkJFf5L+h5oGvIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MC4wMDAwMDAsIDIxMi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJSZWN0YW5nbGUtMiI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Imljb25fc3VjY2VzcyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtMiIgZmlsbD0iIzEzQ0U2NiIgeD0iMCIgeT0iMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIj48L3JlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yNy44MjU1ODE0LDE3LjE0ODQzNTcgTDE5LjAxNzQ0LDI1LjgyODEyMTMgQzE4LjkwMTE2MDksMjUuOTQyNzA4MyAxOC43NjU1MDMzLDI2IDE4LjYxMDQ2NywyNiBDMTguNDU1NDI3LDI2IDE4LjMxOTc2OTMsMjUuOTQyNzA4MyAxOC4yMDM0ODY1LDI1LjgyODEyMTMgTDE4LjAyOTA3MTYsMjUuNjU2MjUgTDEzLjE3NDQxODYsMjAuODQzNzUgQzEzLjA1ODEzOTUsMjAuNzI5MTYzIDEzLDIwLjU5NTQ4MzcgMTMsMjAuNDQyNzA0NyBDMTMsMjAuMjg5OTI5MyAxMy4wNTgxMzk1LDIwLjE1NjI1IDEzLjE3NDQxODYsMjAuMDQxNjY2NyBMMTQuMzY2Mjc3MiwxOC44NjcxODU3IEMxNC40ODI1NiwxOC43NTI2MDIzIDE0LjYxODIxNzcsMTguNjk1MzEwNyAxNC43NzMyNTc3LDE4LjY5NTMxMDcgQzE0LjkyODI5NCwxOC42OTUzMTA3IDE1LjA2Mzk1MTYsMTguNzUyNjAyMyAxNS4xODAyMzA3LDE4Ljg2NzE4NTcgTDE4LjYxMDQ2NywyMi4yNzYwMzggTDI1LjgxOTc2OTMsMTUuMTcxODcxMyBDMjUuOTM2MDQ4NCwxNS4wNTcyODggMjYuMDcxNzA2LDE1IDI2LjIyNjc0MjMsMTUgQzI2LjM4MTc4MjMsMTUgMjYuNTE3NDQsMTUuMDU3Mjg4IDI2LjYzMzcyMjgsMTUuMTcxODcxMyBMMjcuODI1NTgxNCwxNi4zNDYzNTIzIEMyNy45NDE4NjA1LDE2LjQ2MDkzNTcgMjgsMTYuNTk0NjE1IDI4LDE2Ljc0NzM5NCBDMjgsMTYuOTAwMTczIDI3Ljk0MTg2MDUsMTcuMDMzODUyMyAyNy44MjU1ODE0LDE3LjE0ODQzNTcgTDI3LjgyNTU4MTQsMTcuMTQ4NDM1NyBaIiBpZD0iUGF0aCIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"
        alt="" class="el-message__icon">
    <div class="el-message__group">
        <p ng-bind-html="trustAsHtml(ctrl.msgContent)"></p></div>
</div>